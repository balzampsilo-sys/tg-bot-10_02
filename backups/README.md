# üíæ Database Backups

–≠—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite.

## üìÅ –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–æ–≤

–§–∞–π–ª—ã –±—ç–∫–∞–ø–æ–≤ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
```
backup_YYYYMMDD_HHMMSS.sql.gz
```

**–ü—Ä–∏–º–µ—Ä**: `backup_20260211_105530.sql.gz`

- **SQL dump**: –ü–æ–ª–Ω—ã–π –¥–∞–º–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite
- **gzip —Å–∂–∞—Ç–∏–µ**: –≠–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞ (~70-90% —Å–∂–∞—Ç–∏–µ)

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `.env`:

```bash
BACKUP_ENABLED=true              # –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –±—ç–∫–∞–ø—ã
BACKUP_INTERVAL_HOURS=6          # –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
BACKUP_RETENTION_DAYS=30         # –•—Ä–∞–Ω–∏—Ç—å 30 –¥–Ω–µ–π
BACKUP_DIR=backups               # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
```

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ

–ë—ç–∫–∞–ø—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. **–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞** - –Ω–∞—á–∞–ª—å–Ω—ã–π –±—ç–∫–∞–ø
2. **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏** - –∫–∞–∂–¥—ã–µ N —á–∞—Å–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 6)

## üóëÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞

–°—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –§–∞–π–ª—ã —Å—Ç–∞—Ä—à–µ `BACKUP_RETENTION_DAYS` —É–¥–∞–ª—è—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º –±—ç–∫–∞–ø–µ

## üîß –†—É—á–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ Python

```python
from utils.backup_service import BackupService

backup_service = BackupService(
    db_path="bookings.db",
    backup_dir="backups",
    retention_days=30
)

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
backup_service.restore_backup("backups/backup_20260211_105530.sql.gz")
```

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É

```bash
# –†–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å
gunzip -c backups/backup_20260211_105530.sql.gz > restore.sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
sqlite3 bookings.db < restore.sql
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±—ç–∫–∞–ø–∞—Ö:

```python
from utils.backup_service import BackupService

backup_service = BackupService(
    db_path="bookings.db",
    backup_dir="backups",
    retention_days=30
)

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
stats = backup_service.get_stats()
print(stats)
# {
#   'total_backups': 120,
#   'total_size_mb': 15.8,
#   'oldest_backup': datetime(...),
#   'newest_backup': datetime(...),
#   'backup_dir': 'backups'
# }

# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –±—ç–∫–∞–ø–æ–≤
backups = backup_service.list_backups()
for backup in backups:
    print(f"{backup['filename']} - {backup['size_mb']} MB - {backup['age_days']} days old")
```

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- **–ù–µ –∫–æ–º–º–∏—Ç—Ç—å –±—ç–∫–∞–ø—ã –≤ Git**: –§–∞–π–ª—ã `*.sql.gz` –∏—Å–∫–ª—é—á–µ–Ω—ã —á–µ—Ä–µ–∑ `.gitignore`
- **–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ**: –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- **–í–Ω–µ—à–Ω–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–∞–∂–Ω—ã–µ –±—ç–∫–∞–ø—ã –≤–æ –≤–Ω–µ—à–Ω–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ë—ç–∫–∞–ø—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `sqlite3.iterdump()` - –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–µ—Ç–æ–¥
- –ü–µ—Ä–µ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Ç–µ–∫—É—â–µ–π –ë–î
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

---

üìö **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [`utils/backup_service.py`](../utils/backup_service.py)
